<?php 	//initializations	spl_autoload_register(		function($class){			require_once'../classes/'.$class.'.php';		}	);	session_start(Config::get('session/options'));	//end of initializatons	$url = new Url();    $mgt = new Management();    $staff = new Staff();    $std = new Student();    $adm = new Admission();    $user = null;    $message='';    if($mgt->isRemembered()){        $user = $mgt;    }    if($staff->isRemembered()){        $user = $staff;    }    if($std->isRemembered()){        $user = $std;    }    if($adm->isRemembered()){        $user = $adm;    }	if(!isset($user)){ //ensure user is legally logged in        Redirect::to('index.php'); //redirect to exam home page	} //this function helps to return 1,2,3 or 4 when A,B,C or D is passedfunction equivalentAnswer($ans){    $ans = strtoupper($ans);    switch($ans){        case 'A':            return 1;        case 'B':            return 2;        case 'C':            return 3;        case 'D':            return 4;    }}function equivalentLetter($num){    switch($num){        case 1:            return 'A';        case 2:            return 'B';        case 3:            return 'C';        case 4:            return 'D';    }}function outputHeader(){    global $examId;    return (!empty(Input::get('name')))?Utility::escape(Input::get('name')):strtoupper($examId);}//end of functionif(Input::submitted('get') && !empty(Input::get('examid'))){//runs if page is entered via get request with params, this would be true for delete and publish exam functionality    }else{    Redirect::to('index.php'); //redirect to exam index}?><!DOCTYPE html><html lang="en">    <head>        <meta name="HandheldFriendly" content="True">        <meta name="viewport" content="width=device-width, initial-scale=1.0">        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">        <meta http-equiv="X-UA-Compatible" content="IE=edge">        <title>Script</title>        <link rel="stylesheet" type="text/css" href="styles/style.css" />        <link rel="stylesheet" type="text/css" href="styles/script.css" />    </head>    <body>        <?php require_once 'nav.inc.php'; //include the navigation bar?>        <main>            <?php require_once 'header.inc.php'?>        <?php               /* include javascript  and css*/               $examId = Utility::escape(Input::get('examid'));               $examineeId = Utility::escape(Input::get('examineeid'));               $rank = $rank = $user->getRank();               $examinerRank = ''; //initialized so it is accessible by the view result link down the page               if(!empty(Input::get('examinerrank'))){                   $examinerRank = Utility::escape(Input::get('examinerrank'));                                      switch($examinerRank){                       case 2:                           $table = Config::get('users/table_name3');                           $column = Config::get('users/username_column3');                       break;                       case 4:                           $table = Config::get('users/table_name3');                           $column = Config::get('users/username_column3');                       break;                       case 5:                           $table = Config::get('users/table_name1');                           $column = Config::get('users/username_column1');                       break;                       case 17:                           $table = Config::get('users/table_name1');                           $column = Config::get('users/username_column1');                       break;                       case 7:                           $table = Config::get('users/table_name2');                           $column = Config::get('users/username_column2');                       break;                       case 15:                           $table = Config::get('users/table_name2');                           $column = Config::get('users/username_column2');                       break;                   }               }else{                   switch($rank){                       case 1;                       case 2;                       case 3;                       case 4;                       case 5;                       case 6;                           $table = Config::get('users/table_name0');                           $column = Config::get('users/username_column0');                       break;                       case 7;                       case 8;                           $table = Config::get('users/table_name1');                           $column = Config::get('users/username_column1');                       break;                       case 9;                       case 10;                           $table = Config::get('users/table_name2');                           $column = Config::get('users/username_column2');                       break;                       case 11;                       case 12;                           $table = Config::get('users/table_name3');                           $column = Config::get('users/username_column3');                        break;                   }               }                              $exam = new Exam();               $qtn = new Question();               $comExamDetails = $exam->getDetCompletedExam($table, $column, $examId, $examineeId);               if(empty($comExamDetails)){                   Redirect::to(404);               }                $ansArr = json_decode($comExamDetails->answers,true);                $examineeScores = json_decode($comExamDetails->marks, true);                $dbScores = $exam->getExamMarks($examId);                $examineeTotalScore = 0;                $dbTotalScore = 0;                foreach ($examineeScores as $qId=>$mark){                    $examineeTotalScore += round($mark,2);                    $dbTotalScore += $dbScores[$qId];                }                           echo '<div class="sectionheader">'.outputHeader().' Script</div>';               $x=1; //holds the count for the questions               $qtnCount = $exam->getExamineeQtnCount($examId);               $first = true; //use to know when to requery, a requery is made if $first is false               if(!empty($ansArr)){                    foreach($ansArr as $qtnId=>$ans){                        $presentQtn = $qtn->getQuestionDetails($qtnId,$examId);                        $dbAnswer = $presentQtn->answers;                        $rem = false; //initialize to false so that we only have to change to true when the answer is right                        $output='';                        switch($presentQtn->type){                            case 1:                                $equivAns = equivalentAnswer($ans);                                $equivDbAns = equivalentAnswer($dbAnswer);                                $options = json_decode($presentQtn->options,true);                                for($i=1;$i<=4;$i++){                                    if($equivAns === $i){                                        $output.='<div><input type="radio" checked />';                                                                            }else{                                        $output.='<div><input type="radio" disabled />';                                    }                                    $output .= equivalentLetter($i).'.&nbsp;&nbsp;'.$options['opt'.$i].'</div>';                                }                                $ansDiv = '<div class="qtnAnswer">'.$dbAnswer.'</div>';                                break;                            case 2:                                if($ans === 'true'){                                    $output.='<div><input type="radio" checked /> True &nbsp; <input type="radio" disabled /> False</div>';                                                                    }else{                                    if($ans === 'false'){                                        $output.='<div><input type="radio" disabled /> True &nbsp; <input type="radio" checked/> False</div>';                                    }                                }                                if($examineeScores[$qtnId] >= ($presentQtn->mark / 2)){                                    $rem = true;                                }                                $ansDiv = '<div class="qtnAnswer">'.ucfirst($dbAnswer).'</div>';                                break;                            case 3:                                $answers = json_decode($ans,true);                                $dbAnswer = json_decode($dbAnswer,true);                                $corrAnsCount = 0;                                $allAns = ''; //this is to hold all the answers so it can be used in the $ansDiv var                                $ansLen = count($dbAnswer); //$answer and $dbAnswer have thesame lenght, any of them can be used                                for($i=1;$i<=$ansLen;$i++){                                    $output.='<span class="germanboxlabel">Answer '.$i.': </span> <span>'.$answers["ans".$i].'</span><br>';                                    if(Utility::equals($answers["ans".$i], $dbAnswer["ans".$i])){                                        $corrAnsCount++;                                    }                                    if($i === $ansLen){                                        $allAns.=$dbAnswer["ans".$i];                                    }else{                                        $allAns.=$dbAnswer["ans".$i].', ';                                    }                                }                                                                $ansDiv = '<div class="qtnAnswer">'.$allAns.'</div>';                                break;                            case 4:                                $answers = json_decode($ans,true);                                $dbAnswer = json_decode($dbAnswer,true);                                $options = json_decode($presentQtn->options,true);                                $noWrongAns = true;                                $allAns='';                                for($i=1;$i<=4;$i++){                                    if(array_key_exists('ans'.$i,$answers)){                                                                               if(!array_key_exists('ans'.$i,$dbAnswer)){                                             $output.='<div class="failure"><span class="checkboxlabel">option '.$i.'</span>:&nbsp; <span>'.$options["opt".$i].'</span> <input type="checkbox" checked disabled /></div>';                                            $noWrongAns = false;                                        }else{                                             $output.='<div><span class="checkboxlabel">option '.$i.'</span>:&nbsp; <span>'.$options["opt".$i].'</span> <input type="checkbox" checked disabled /></div>';                                        }                                    }else{                                        $output.='<div>option '.$i.':&nbsp; <span>'.$options["opt".$i].'</span> <input type="checkbox" disabled /></div>';                                        if(array_key_exists('ans'.$i,$dbAnswer)){                                            $noWrongAns = false;                                        }                                    }                                    if(array_key_exists('ans'.$i,$dbAnswer)){                                        $allAns.=$dbAnswer["ans".$i].', ';                                    }                                                                    }                                                               $len = strlen($allAns);                                $allAns = substr($allAns,0,$len-2); //remove the ',' that is appended at the                                $ansDiv = '<div class="qtnAnswer">'.$allAns.'</div>';                                break;                            case 5:                                  $comment = $exam->getTheoryComment($examId,$examineeId,$qtnId,$first);                                $first = false;                                $output.= '<div>'.$ans.'</div><div class="comment">'.$comment.'</div>';                                $ansDiv = '<div class="qtnAnswer">'.$dbAnswer.'</div>';                        }                         if($examineeScores[$qtnId] >= ($presentQtn->mark / 2)){                            $rem = true;                        }                                            $className = ($rem)?'examsuccess':'examfailure';                                                echo'<div class="'.$className.' qtnWrapper">';                            echo'<div class="qtnScoreDiv"><span class="questionNo">Q '.$x.'/'.$qtnCount.'</span><span class="questionScore">Score: '.$examineeScores[$qtnId].'/'.$dbScores[$qtnId].'</span></div>'; //output the question no                            echo '<div class="questionDiv">'.$presentQtn->qtn.'</div>'; //output the question                            echo '<div class="options">'. $output.= $ansDiv.'</div>'; //output the options with the answers;                                                   echo '</div>';                        $x++;                    }                     echo'<div id="totScorePercentage"><span id="totalscore"><p>'.$examineeTotalScore.'</p><p style="border-bottom: 2px solid red; width: 30px; margin: auto;"></p><p>'.$dbTotalScore.'</p></span> &nbsp;<span>'.round(($examineeTotalScore / $dbTotalScore)*100,2).'%</span></div>';                    ?><div id="resultLink"><a href="<?php echo 'result.php?examid='.$examId.'&examineeid='.$examineeId.'&examinerrank='.$examinerRank ?>"><i class="fa fa-eye"></i> view result</a></div> <?php               }else{                   echo'<div class="message">There is no script for this examinee</div>';               }                       ?>        </main>    </body></html>